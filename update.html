<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plugin Update Center | Maximka1993271</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; padding: 40px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; }
        .config-box { background: #1e293b; padding: 30px; border-radius: 12px; border: 1px solid #38bdf8; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 30px; }
        h2 { color: #38bdf8; margin-top: 0; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        h3 { color: #7dd3fc; margin-top: 25px; }
        pre { background: #000; padding: 20px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; border: 1px solid #1e293b; color: #e2e8f0; }
        .info { color: #94a3b8; font-size: 1.1em; margin-bottom: 20px; }
        .status-tag { display: inline-block; background: #0ea5e9; color: #f0f9ff; padding: 2px 10px; border-radius: 4px; font-size: 0.8em; vertical-align: middle; margin-left: 10px; }
        .warning-tag { background: #ef4444; color: white; padding: 2px 10px; border-radius: 4px; font-size: 0.8em; margin-left: 10px; }
        code { color: #38bdf8; font-weight: bold; }
        .step { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="config-box">
            <h2>System Auto-Update (SourceMod Updater) <span class="status-tag">Active v2.0.3</span></h2>
            <p class="info">This configuration is used by <code>updater.smx</code> to bypass Windows write restrictions by using the logs directory.</p>
            
            <div style="background: #0c4a6e; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #38bdf8;">
                <p style="margin: 0;"><span class="step">IMPORTANT:</span> Ensure <code>srcds.exe</code> is running with <b>Administrator Privileges</b> to avoid 0KB file errors.</p>
            </div>

            <h3>Current JSON Manifest (34 Plugins)</h3>
            <pre>
{
  "version": "2.0.3",
  "files": [
    "test_download.smx", "awp_tracers.smx", "bomb_events.smx", "bot_ping.smx",
    "c4_effects.smx", "check_steam_online.smx", "colored_smoke.smx", "connect_announce.smx",
    "console_motd.smx", "css_gore.smx", "dissolve_fade.smx", "dissolve_fire.smx",
    "flashlight.smx", "grenades_messages.smx", "hostage_down.smx", "ip_blocker.smx",
    "killer_info_distance.smx", "knife_kill_bonus.smx", "mani_show_damage.smx", "medic.smx",
    "most_destructive.smx", "noblock.smx", "panel.smx", "prop_interaction.smx",
    "protectcmds.smx", "quick_defuse.smx", "real_time.smx", "resetscore.smx",
    "show_damage.smx", "spawn_effect.smx", "team_join_message.smx", "updater.smx",
    "welcome_message.smx", "welcome_sound.smx"
  ]
}</pre>

            <h3>Core Plugin Source (Memory & Write Optimized)</h3>
            <pre>
#include &lt;sourcemod&gt;
#include &lt;SteamWorks&gt;

#pragma semicolon 1
#pragma newdecls required

#define PLUGIN_VERSION "2.0.3"
#define URL_VERSION "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/updater/version.json"
#define URL_PLUGINS_BASE "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/"

ArrayList g_hFiles;
int g_iCurrent = 0;

public void OnPluginStart() {
    RegAdminCmd("sm_plugins_download", Command_SyncAll, ADMFLAG_ROOT);
    g_hFiles = new ArrayList(PLATFORM_MAX_PATH);
}

public Action Command_SyncAll(int client, int args) {
    g_iCurrent = 0; g_hFiles.Clear();
    Handle hReq = SteamWorks_CreateHTTPRequest(k_EHTTPMethodGET, URL_VERSION);
    SteamWorks_SetHTTPRequestHeaderValue(hReq, "User-Agent", "SourceMod-Updater");
    SteamWorks_SetHTTPCallbacks(hReq, OnManifestReceived);
    SteamWorks_SendHTTPRequest(hReq);
    return Plugin_Handled;
}

public void OnManifestReceived(Handle hRequest, bool bFailure, bool bRequestSuccessful, EHTTPStatusCode eStatusCode) {
    if (bRequestSuccessful && eStatusCode == k_EHTTPStatusCode200OK) {
        int iSize; SteamWorks_GetHTTPResponseBodySize(hRequest, iSize);
        char[] sBody = new char[iSize + 1];
        SteamWorks_GetHTTPResponseBodyData(hRequest, sBody, iSize);
        sBody[iSize] = '\0';
        int pos = 0; char sName[PLATFORM_MAX_PATH];
        while ((pos = FindNextSMX(sBody, pos, sName, sizeof(sName))) != -1) {
            g_hFiles.PushString(sName);
        }
        DownloadNext();
    }
    delete hRequest;
}

void DownloadNext() {
    if (g_iCurrent >= g_hFiles.Length) return;
    char sName[PLATFORM_MAX_PATH], sUrl[512], sLoc[PLATFORM_MAX_PATH];
    g_hFiles.GetString(g_iCurrent, sName, sizeof(sName));
    Format(sUrl, sizeof(sUrl), "%s%s", URL_PLUGINS_BASE, sName);
    BuildPath(Path_SM, sLoc, sizeof(sLoc), "../../logs/%s", sName);
    Handle hReq = SteamWorks_CreateHTTPRequest(k_EHTTPMethodGET, sUrl);
    SteamWorks_SetHTTPRequestHeaderValue(hReq, "User-Agent", "SourceMod-Updater");
    SteamWorks_WriteHTTPResponseBodyToFile(hReq, sLoc);
    SteamWorks_SetHTTPCallbacks(hReq, OnFileDone);
    SteamWorks_SendHTTPRequest(hReq);
}

public void OnFileDone(Handle hRequest, bool bFailure, bool bRequestSuccessful, EHTTPStatusCode eStatusCode) {
    delete hRequest; g_iCurrent++;
    CreateTimer(0.2, Timer_Next); 
}

public Action Timer_Next(Handle timer) { DownloadNext(); return Plugin_Stop; }

int FindNextSMX(const char[] text, int start, char[] buffer, int maxlen) {
    int endIdx = StrContains(text[start], ".smx");
    if (endIdx == -1) return -1;
    endIdx += start + 4;
    int startIdx = endIdx - 4;
    while (startIdx > start && text[startIdx] != '"') startIdx--;
    if (text[startIdx] == '"') {
        strcopy(buffer, (endIdx - startIdx < maxlen) ? (endIdx - startIdx) : maxlen, text[startIdx + 1]);
        return endIdx;
    }
    return -1;
}</pre>
        </div>
    </div>

</body>
</html>