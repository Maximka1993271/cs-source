<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plugin Update Center | Maximka1993271</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; padding: 40px; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }
        .config-box { background: #1e293b; padding: 30px; border-radius: 12px; border: 1px solid #38bdf8; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 30px; }
        h2 { color: #38bdf8; margin-top: 0; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        h3 { color: #7dd3fc; margin-top: 25px; }
        pre { background: #000; padding: 20px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; border: 1px solid #1e293b; color: #e2e8f0; }
        .info { color: #94a3b8; font-size: 1.1em; margin-bottom: 20px; }
        .status-tag { display: inline-block; background: #0369a1; color: #f0f9ff; padding: 2px 10px; border-radius: 4px; font-size: 0.8em; vertical-align: middle; margin-left: 10px; }
        code { color: #38bdf8; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="config-box">
            <h2>System Auto-Update (SourceMod Updater) <span class="status-tag">Active v1.4.3</span></h2>
            <p class="info">This configuration is used by <code>updater.smx</code> to synchronize the server with the GitHub repository.</p>
            
            <h3>Current manifest (34 Plugins)</h3>
            <pre>
"Updater"
{
    "Information"
    {
        "Version"   "1.4.3"
        "Notes"     "Full sync enabled for 34 plugins. Fixed Buffer/Size logic."
    }

    "Files"
    {
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/updater.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/awp_tracers.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/bomb_events.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/dissolve_fade.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/dissolve_fire.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/grenade_trails.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/killer_info_distance.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/spawn_effect.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/team_join_message.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/welcome_sound.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/noblock.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/resetscore.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/round_end_sound.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/advertisements.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/show_damage.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/knife_dm.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/skins_manager.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/medkit.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/fakedevices.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/chat_processor.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/mapchooser.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/nominations.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/rockthevote.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/rankme.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/high_ping_kicker.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/anti_team_flash.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/block_radio_spam.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/save_scores.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/players_list.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/advanced_admin.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/afk_manager.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/all_chat.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/weapon_restrict.smx"
        "Plugin" "https://raw.githubusercontent.com/Maximka1993271/cs-source/main/plugins/sm_skin_chooser.smx"
    }
}
            </pre>

            <h3>Core Plugin Source (English)</h3>
            <pre>
#include &lt;sourcemod&gt;
#include &lt;SteamWorks&gt;

#pragma semicolon 1
#pragma newdecls required

#define PLUGIN_VERSION "1.4.3"

#define URL_VERSION "http://cdn.jsdelivr.net/gh/Maximka1993271/cs-source@main/updater/version.json"
#define URL_PLUGINS_BASE "http://cdn.jsdelivr.net/gh/Maximka1993271/cs-source@main/plugins/"

ArrayList g_hDownloadQueue;
int g_iActiveIndex = 0;

public Plugin myinfo = {
    name = "Ultimate Mass Updater",
    author = "Maxim Melnikov",
    description = "Syncs plugins using fixed Buffer/Size logic",
    version = PLUGIN_VERSION,
    url = "https://github.com/Maximka1993271/cs-source"
};

public void OnPluginStart() {
    RegAdminCmd("sm_plugins_download", Command_SyncAll, ADMFLAG_ROOT);
    g_hDownloadQueue = new ArrayList(PLATFORM_MAX_PATH);
}

public Action Command_SyncAll(int client, int args) {
    char sUrl[512];
    Format(sUrl, sizeof(sUrl), "%s?t=%d", URL_VERSION, GetTime());
    
    Handle hReq = SteamWorks_CreateHTTPRequest(k_EHTTPMethodGET, sUrl);
    if (hReq != INVALID_HANDLE) {
        SteamWorks_SetHTTPRequestHeaderValue(hReq, "User-Agent", "SourceMod-Updater");
        SteamWorks_SetHTTPCallbacks(hReq, OnConfigReceived);
        SteamWorks_SendHTTPRequest(hReq);
        PrintToServer("[Updater] Starting sync v%s...", PLUGIN_VERSION);
    }
    return Plugin_Handled;
}

public void OnConfigReceived(Handle hRequest, bool bFailure, bool bRequestSuccessful, EHTTPStatusCode eStatusCode) {
    if (bRequestSuccessful && eStatusCode == k_EHTTPStatusCode200OK) {
        int iSize;
        SteamWorks_GetHTTPResponseBodySize(hRequest, iSize);
        if (iSize > 0) {
            char[] sBody = new char[iSize + 1]; 
            SteamWorks_GetHTTPResponseBodyData(hRequest, sBody, iSize);
            sBody[iSize] = '\0'; 
            g_hDownloadQueue.Clear();
            g_iActiveIndex = 0;
            int currentPos = 0;
            char sFile[PLATFORM_MAX_PATH];
            while ((currentPos = ExtractFileName(sBody, currentPos, sFile, sizeof(sFile))) != -1) {
                if (StrContains(sFile, ".smx", false) != -1 && StrContains(sFile, "version", false) == -1) {
                    g_hDownloadQueue.PushString(sFile);
                }
            }
            if (g_hDownloadQueue.Length > 0) {
                PrintToServer("[Updater] Found %d files. Starting...", g_hDownloadQueue.Length);
                DownloadNext();
            }
        }
    }
    delete hRequest;
}

void DownloadNext() {
    if (g_iActiveIndex >= g_hDownloadQueue.Length) {
        PrintToServer("[Updater] SYNC COMPLETE!");
        ServerCommand("sm plugins reload updater");
        return;
    }
    char sName[PLATFORM_MAX_PATH], sUrl[512], sLoc[PLATFORM_MAX_PATH];
    g_hDownloadQueue.GetString(g_iActiveIndex, sName, sizeof(sName));
    Format(sUrl, sizeof(sUrl), "%s%s", URL_PLUGINS_BASE, sName);
    BuildPath(Path_SM, sLoc, sizeof(sLoc), "plugins/%s", sName);
    Handle hReq = SteamWorks_CreateHTTPRequest(k_EHTTPMethodGET, sUrl);
    if (!SteamWorks_WriteHTTPResponseBodyToFile(hReq, sLoc)) {
        PrintToServer("[Updater] WARNING: File %s is locked by OS.", sName);
    }
    SteamWorks_SetHTTPCallbacks(hReq, OnFileDownloaded);
    SteamWorks_SendHTTPRequest(hReq);
    PrintToServer("[%d/%d] Downloading: %s", g_iActiveIndex + 1, g_hDownloadQueue.Length, sName);
}

public void OnFileDownloaded(Handle hRequest, bool bFailure, bool bRequestSuccessful, EHTTPStatusCode eStatusCode) {
    g_iActiveIndex++;
    DownloadNext();
    delete hRequest;
}

int ExtractFileName(const char[] text, int start, char[] buffer, int maxlen) {
    int first = -1;
    for (int i = start; text[i] != '\0'; i++) {
        if (text[i] == '"') {
            if (first == -1) first = i;
            else {
                strcopy(buffer, (i - first < maxlen) ? i - first : maxlen, text[first + 1]);
                return i + 1;
            }
        }
    }
    return -1;
}
            </pre>
        </div>
    </div>

</body>
</html>